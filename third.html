<html>
    <head>
        <title>CG - Babylon</title>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
        <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>




        <style>
          html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
          }
          #render {
            width: 100%;
            height: 100%;
            touch-action: none;
          }
        </style>
    <body>
        <canvas id="render" touch-action="none">
        <script>
            var canvas = document.getElementById("render");
            var engine = new BABYLON.Engine(canvas, true);

            var createScene = function() {
                var scene = new BABYLON.Scene(engine);
                    // street
                    var multiplier = 17;
                    // light
                    var light1 = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(2, 1, 0), scene);
                    light1.intensity = 1;
                    var floor = BABYLON.MeshBuilder.CreateGround("street", {width: 5*multiplier, height: 5*multiplier, subdivisions: 4}, scene);
                    floor.position.x = 0;
                    floor.position.y = -multiplier/2;
                    floor.color = new BABYLON.Color3(1,1,1);
                    // collision house and street
                    floor.checkCollisions = true;

                    //wall a
                    var walla = BABYLON.MeshBuilder.CreateBox("box", {width: 5*multiplier, height: 1.5*multiplier,size: 1}, scene);
                    walla.position.x = 0*multiplier;
                    walla.position.z = -2.5*multiplier;
                    walla.color = new BABYLON.Color3(0,0,0);
                    walla.checkCollisions = true;

                    //wall b
                    var wallb = BABYLON.MeshBuilder.CreateBox("box", {width: 5.055*multiplier, height: 1.5*multiplier,size: 1}, scene);
                    wallb.position.x = -2.5*multiplier;
                    wallb.position.z = 0*multiplier;
                    wallb.rotation.y = Math.PI/2;
                    wallb.color = new BABYLON.Color3(0,0,0);
                    wallb.checkCollisions = true;

                    //wall c
                    var wallc = BABYLON.MeshBuilder.CreateBox("box", {width: 5.055*multiplier, height: 1.5*multiplier,size: 1}, scene);
                    wallc.position.x = 2.5*multiplier;
                    wallc.position.z = 0*multiplier;
                    wallc.rotation.y = Math.PI/2;
                    wallc.color = new BABYLON.Color3(0,0,0);
                    wallc.checkCollisions = true;

                    //wall d
                    var walld = BABYLON.MeshBuilder.CreateBox("box", {width: 5*multiplier, height: 1.5*multiplier,size: 1}, scene);
                    walld.position.x = 0*multiplier;
                    walld.position.z = 2.5*multiplier;
                    walld.color = new BABYLON.Color3(0,0,0);
                    walld.checkCollisions = true;

                    //wall e
                    var walle = BABYLON.MeshBuilder.CreateBox("box", {width: 3*multiplier, height: 1.5*multiplier,size: 1}, scene);
                    walle.position.x = .75* multiplier;
                    walle.position.z = 1*multiplier;
                    walle.rotation.y = Math.PI/2;
                    walle.color = new BABYLON.Color3(0,0,0);
                    walle.checkCollisions = true;

                    //wall f
                    var wallf = BABYLON.MeshBuilder.CreateBox("box", {width: 1.25*multiplier, height: 1.5*multiplier,size: 1}, scene);
                    wallf.position.x = .75* multiplier;
                    wallf.position.z = -1.875*multiplier;
                    wallf.rotation.y = Math.PI/2;
                    wallf.color = new BABYLON.Color3(0,0,0);
                    wallf.checkCollisions = true;

                    // wall g
                    var wallg = BABYLON.MeshBuilder.CreateBox("box", {width: 1.5*multiplier, height: 1.5*multiplier,size: 1}, scene);
                    wallg.position.x = -1.75*multiplier;
                    wallg.position.z = .75 * multiplier;
                    wallg.color = new BABYLON.Color3(0,0,0);
                    wallg.checkCollisions = true;

                    //wall h
                    var wallh = BABYLON.MeshBuilder.CreateBox("box", {width: .5*multiplier, height: 1.5*multiplier,size: 1}, scene);
                    wallh.position.x = 2.25*multiplier;
                    wallh.position.z = .75 * multiplier;
                    wallh.color = new BABYLON.Color3(0,0,0);
                    wallh.checkCollisions = true;

                    //wall i
                    var walli = BABYLON.MeshBuilder.CreateBox("box", {width: .75*multiplier, height: 1.5*multiplier,size: 1}, scene);
                    walli.position.x = 1.15*multiplier;
                    walli.position.z = .75 * multiplier;
                    walli.color = new BABYLON.Color3(0,0,0);
                    walli.checkCollisions = true;

                    var bordera = BABYLON.MeshBuilder.CreateBox("box", {width: .48*multiplier, height: .155*multiplier,size: 1}, scene);
                    bordera.position.x = 1.765*multiplier;
                    bordera.position.y = .675 *multiplier;
                    bordera.position.z = .75 * multiplier;
                    bordera.checkCollisions = true;
                    var borderb = BABYLON.MeshBuilder.CreateBox("box", {width: .75*multiplier, height: .15*multiplier,size: 1}, scene);
                    borderb.position.x = .75* multiplier;
                    borderb.position.y = .675 *multiplier;
                    borderb.position.z = -.875*multiplier;
                    borderb.rotation.y = Math.PI/2;
                    borderb.checkCollisions = true;

                    BABYLON.SceneLoader.ImportMesh("", "Import/LivingRoom/Table/", "table.obj", scene, function(newMeshes) {
                          // You can apply properties to object.
                          for (i = 0; i < newMeshes.length; i++)
                          {
                          setup(newMeshes[i]);
                          var table = newMeshes[i];
                          table_model = table;
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.position = new BABYLON.Vector3(-1.75*multiplier, floor.position.y, -.75*multiplier); mesh.scaling = new BABYLON.Vector3(.1*multiplier, .1*multiplier, .1*multiplier); }
                          }
                          var mesh = newMeshes[0];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*2, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2);
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;




                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/Bedroom/Desk/", "table2.obj", scene, function(newMeshes) {
                          // You can apply properties to object.
                          for (i = 0; i < newMeshes.length; i++)
                          {
                          var desk = newMeshes[i];
                          desk_model = desk;
                          setup(newMeshes[i]);
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.Color = new BABYLON.Color3(1, 0, 0); mesh.rotation.y = Math.PI/2; mesh.position = new BABYLON.Vector3(1.15*multiplier, floor.position.y, 0.275*multiplier); mesh.scaling = new BABYLON.Vector3(.6*multiplier, .6*multiplier,.6*multiplier); }
                          }
                          var mesh = newMeshes[3];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*1.275, modele.boundingBox.maximum.y*2.25, modele.boundingBox.maximum.z*13);
                          collider.parent = mesh;
                          collider.position.z=-0.25;
                          collider.position.x=0.4;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0.5;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;




                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/DiningRoom/Kitchen2/", "kitchen.obj", scene, function(newMeshes) {
                          // You can apply properties to object.
                          for (i = 0; i < newMeshes.length; i++)
                          {
                          var kitchen = newMeshes[i];
                          kitchen_model = kitchen;
                          setup(newMeshes[i]);
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.rotation.y = Math.PI/2; mesh.position = new BABYLON.Vector3(-2.25*multiplier, floor.position.y, 1.5*multiplier); mesh.scaling = new BABYLON.Vector3(.05*multiplier, .05*multiplier, .05*multiplier); }
                          }
                          var mesh = newMeshes[0];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*2.575, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2);
                          collider.position.x = -2.8;
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;

                    });

                    BABYLON.SceneLoader.ImportMesh("", "Import/LivingRoom/Sofa/", "sofa.obj", scene, function(newMeshes) {
                          // You can apply properties to object.
                          for (i = 0; i < newMeshes.length; i++)
                          {
                          setup(newMeshes[i]);
                          var sofa = newMeshes[i];
                          sofa_model = sofa;
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.rotation.y = -Math.PI/2; mesh.position = new BABYLON.Vector3(-.75*multiplier, floor.position.y, -.75*multiplier); mesh.scaling = new BABYLON.Vector3(.5*multiplier, .5*multiplier, .5*multiplier); }
                          }
                          var mesh = newMeshes[0];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*2, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2);
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;

                    });

                    BABYLON.SceneLoader.ImportMesh("", "Import/Bedroom/Bed/", "arc-double-bed-light-2.obj", scene, function(newMeshes) {
                          // You can apply properties to object.
                          for (i = 0; i < newMeshes.length; i++)
                          {
                          setup(newMeshes[i]);
                          var bed = newMeshes[i];
                          bed_model = bed;
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.position = new BABYLON.Vector3(1.65*multiplier, floor.position.y, -1.75*multiplier); mesh.scaling = new BABYLON.Vector3(.5*multiplier, .5*multiplier, .5*multiplier); }
                          }
                          var mesh = newMeshes[0];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*2, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2);
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;
                    });
                    var rack = BABYLON.SceneLoader.ImportMesh("", "", "Rack.obj", scene, function(newMeshes) {
                          // You can apply properties to object.
                          for (i = 0; i < newMeshes.length; i++)
                          {
                          setup(newMeshes[i]);
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.position = new BABYLON.Vector3(1.65*multiplier, floor.position.y, -1.75*multiplier); mesh.scaling = new BABYLON.Vector3(.5*multiplier, .5*multiplier, .5*multiplier); }
                          }
                          var mesh = newMeshes[0];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*2, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2);
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/Bedroom/Lamp/", "lampa.obj", scene, function(newMeshes) {
                          // You can apply properties to object.
                          for (i = 0; i < newMeshes.length; i++)
                          {
                          setup(newMeshes[i]);
                          var lamp = newMeshes[i];
                          lamp_model = lamp;
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.position = new BABYLON.Vector3(2.25*multiplier, floor.position.y, -2*multiplier); mesh.scaling = new BABYLON.Vector3(.5*multiplier, .5*multiplier, .5*multiplier); }
                          }
                          var mesh = newMeshes[0];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*2, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2);
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;
                    });

                    BABYLON.SceneLoader.ImportMesh("", "Import/Bathroom/Toilet/", "toilet-water-closet.obj", scene, function(newMeshes) {
                          // You can apply properties to object.
                          for (i = 0; i < newMeshes.length; i++)
                          {
                          setup(newMeshes[i]);
                          var toilet = newMeshes[i];
                          toilet_model = toilet;
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.rotation.y = Math.PI/2; mesh.position = new BABYLON.Vector3(1*multiplier, floor.position.y, 1.25*multiplier); mesh.scaling = new BABYLON.Vector3(.0125*multiplier, .0125*multiplier, .0125*multiplier); }
                          }
                          var mesh = newMeshes[0];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*2, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2);
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;

                    });

                    BABYLON.SceneLoader.ImportMesh("", "Import/Bathroom/Sink/", "bathroom-2.obj", scene, function(newMeshes) {
                          // You can apply properties to object.
                          for (i = 0; i < newMeshes.length; i++)
                          {
                          setup(newMeshes[i]);
                          var sink = newMeshes[i];
                          sink_model = sink;
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.rotation.y = Math.PI/2; mesh.position = new BABYLON.Vector3(.85*multiplier, floor.position.y, 2*multiplier); mesh.scaling = new BABYLON.Vector3(40*multiplier, 40*multiplier, 40*multiplier); }
                          }
                          var mesh = newMeshes[0];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*3.5, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2.75);
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;
                    });

                     BABYLON.SceneLoader.ImportMesh("", "Import/DiningRoom/DiningTable/", "table-and-chairs.obj", scene, function(newMeshes) {
                          // You can apply properties to object
                          for (i = 0; i < newMeshes.length; i++)
                          {
                          setup(newMeshes[i]);
                          var diningtable = newMeshes[i];
                          diningtable_model = diningtable;
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.position = new BABYLON.Vector3(-.25*multiplier, floor.position.y, 1.5*multiplier); mesh.scaling = new BABYLON.Vector3(.5*multiplier, .5*multiplier, .5*multiplier); }
                          }
                          var mesh = newMeshes[0];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*2, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2);
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;
                    });

                    BABYLON.SceneLoader.ImportMesh("", "Import/Bathroom/Bath/", "bath_obj.obj", scene, function(newMeshes) {
                          // You can apply properties to object

                          for (i = 0; i < newMeshes.length; i++)
                          {
                          setup(newMeshes[i]);
                          var bath = newMeshes[i];
                          bath_model = bath;
                          //put scaling and position inside function below
                          function setup(mesh) {mesh.rotation.y = Math.PI/2; mesh.position = new BABYLON.Vector3(2.2*multiplier, floor.position.y, 1.85*multiplier); mesh.scaling = new BABYLON.Vector3(.025*multiplier, .025*multiplier, .025*multiplier); }
                          }
                          var mesh = newMeshes[0];
                            camera.target = mesh;
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*2, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2);
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;

                    });



                    // camera
                    var camera = new BABYLON.FlyCamera("Camera", new BABYLON.Vector3(0, 5, 5), scene); // AWSD
                    //var camera = new BABYLON.ArcRotateCamera("Camera", 0, Math.PI / 2, 10, new BABYLON.Vector3.Zero(), scene);
                    camera.attachControl(canvas, true);
                    camera.maxCameraSpeed =  0.4;
                    camera.speed = .35;
                    camera.rollCorrect = 10;


                    // gravity
                    scene.gravity = new BABYLON.Vector3(0, -9.81, 0);
                    camera.applyGravity = true;
                    camera.ellipsoid = new BABYLON.Vector3(1, 7, 1);
                    scene.collisionsEnabled = true;
                    camera.checkCollisions = true;
                    scene.checkCollisions = true;


                    canvas.requestPointerLock()
                    document.exitPointerLock = document.exitPointerLock;
                    canvas.onclick = function() {
                    canvas.requestPointerLock();
                    }
                      var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");
                      var rect1 = new BABYLON.GUI.Rectangle();
                          rect1.width = 0.2;
                          rect1.height = "100px";
                          rect1.cornerRadius = 10;
                          rect1.color = "black";
                          rect1.thickness = 0;
                          rect1.background = "black";
                          rect1.alpha = .5;
                          rect1.left = "-700px";
                          rect1.top	 = "-290px";
                          advancedTexture.addControl(rect1);
                      var objectives= new BABYLON.GUI.TextBlock();
                          objectives.text = "Objectives:";
                          objectives.color = "white";
                          objectives.fontSize = 24;
                          objectives.fontFamily = 'Times';
                          objectives.fontWeight = "bold";
                          objectives.left = "-700px";
                          objectives.top	 = "-300px"
                      advancedTexture.addControl(objectives);

                      var objectives1= new BABYLON.GUI.TextBlock();
                          objectives1.text = "- Make Breakfast ";
                          objectives1.color = "white";
                          objectives1.fontSize = 20;
                          objectives1.fontFamily = 'Times';
                          objectives1.left = "-680px";
                          objectives1.top	 = "-270px"
                      advancedTexture.addControl(objectives1);
                      var click = 0;
                      if(click == 1)
                      {
                        objectives1.text = "-Make Be ";
                      };


                    var sphere = BABYLON.MeshBuilder.CreateSphere("sphere", {diameter: 2}, scene);
                    sphere.position.y = 5;

                    var rect1 = new BABYLON.GUI.Rectangle();
                    rect1.width = 0.15;
                    rect1.height = "40px";
                    rect1.color = "white";
                    rect1.thickness = 4;
                    rect1.background = "transparent";
                    advancedTexture.addControl(rect1);
                    rect1.linkOffsetY = -150;


                    var label = new BABYLON.GUI.TextBlock();
                    label.text = "E";
                    rect1.addControl(label);

                    var target = new BABYLON.GUI.Ellipse();
                    target.width = "40px";
                    target.height = "40px";
                    target.color = "white";
                    target.thickness = 4;
                    target.background = "transparent";
                    advancedTexture.addControl(target);

                    var line = new BABYLON.GUI.Line();
                    line.lineWidth = 4;
                    line.color = "whites";
                    line.y2 = 20;
                    line.linkOffsetY = -20;
                    advancedTexture.addControl(line);
                    line.connectedControl = rect1;
                    var map = {}; //object for multiple key presses
                    scene.actionManager = new BABYLON.ActionManager(scene);

                    scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger, function (evt) {
                        map[evt.sourceEvent.key] = evt.sourceEvent.type == "keydown";

                    }));

                    scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, function (evt) {
                        map[evt.sourceEvent.key] = evt.sourceEvent.type == "keydown";
                    }));


                    scene.registerAfterRender(function () {

                        if ((map["Shift"])) {
                            camera.maxCameraSpeed =  .75;
                            camera.speed = .65;
                                }
                        else{
                          camera.maxCameraSpeed =  0.3;
                          camera.speed = .25;
                        };
                        if(BABYLON.Vector3.Distance(camera.position,sphere.position) <5){
                          rect1.linkWithMesh(bath_model);
                          target.linkWithMesh(bath_model);
                          line.linkWithMesh(bath_model);
                            if ((map["e"]) || (map["E"])) {
                                //scene.meshes[11].dispose();
                                diningtable_model.dispose();
                                console.log(bath_model.name);
                                camera.speed =0;

                                rect1.linkWithMesh(toilet_model);
                                target.linkWithMesh(toilet_model);
                                line.linkWithMesh(toilet_model);



                                };
                        };

                    });









            return scene;
            }
            var scene = createScene();
            engine.runRenderLoop(function() {
            scene.render();
            });
            window.addEventListener("size", function() {
            engine.size();
            });
        </script>
    </body>
</html>
