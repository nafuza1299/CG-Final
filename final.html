<html>
    <head>
        <title>CG - Babylon</title>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
        <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
        <script src="babylon.objFileLoader.js"></script>

        <style>
          html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
          }
          #render {
            width: 100%;
            height: 100%;
            touch-action: none;
          }
        </style>
    <body>
        <canvas id="render" touch-action="none">
        <script>
            var canvas = document.getElementById("render");
            var engine = new BABYLON.Engine(canvas, true);
            var createScene = function() {
                var scene = new BABYLON.Scene(engine);
                    // street
                    var street = BABYLON.MeshBuilder.CreateGround("street", {width: 30, height: 35, subdivisions: 4}, scene);
                    street.position.x = 0;
                   street.color = new BABYLON.Color3(0,0,0);
                    // house
                    var house = BABYLON.SceneLoader.ImportMesh("", "", "interior.obj", scene, function(newMeshes) {
                          // You can apply properties to object.
                           var mesh = newMeshes[0];
                            camera.target = mesh;	
                          
                          var collider = BABYLON.Mesh.CreateBox("collider_box", 0, scene, false);		
                          var modele = mesh.getBoundingInfo();
                          collider.scaling = new BABYLON.Vector3(modele.boundingBox.maximum.x*2, modele.boundingBox.maximum.y*2, modele.boundingBox.maximum.z*2);
                          collider.parent = mesh;
                          collider.material = new BABYLON.StandardMaterial("collidermat", scene);
                          collider.material.alpha = 0.3;
                          collider.checkCollisions = true;
                          collider.CollisionsEnabled = true;
                  });

                    // collision house and street
                    street.checkCollisions = true;
                    street.visibility =0;


                    // camera
                    var camera = new BABYLON.FlyCamera("Camera", new BABYLON.Vector3(-10, 30, 10.3), scene); // AWSD
                    camera.attachControl(canvas, true);
                    camera.maxCameraSpeed =  0.3;
                    camera.speed = .25;
                    camera.rollCorrect = 10;


                    // gravity
                    scene.gravity = new BABYLON.Vector3(0, -9.81, 0);
                    camera.applyGravity = true;
                    camera.ellipsoid = new BABYLON.Vector3(1, 1, 1);
                    scene.collisionsEnabled = true;
                    camera.checkCollisions = true;
                    scene.checkCollisions = true;
                    house.collisionsEnabled = true;
                    house.checkCollisions = true;


                    // movement camera without crosshair
                    canvas.requestPointerLock = canvas.requestPointerLock;
                    canvas.requestPointerLock()
                    document.exitPointerLock = document.exitPointerLock;
                    canvas.onclick = function() {
                    canvas.requestPointerLock();
                    }
                    // light
                    var light1 = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(2, 1, 0), scene);
                    light1.intensity = 1;

            return scene;
            }
            var scene = createScene();
            engine.runRenderLoop(function() {
            scene.render();
            });
            window.addEventListener("size", function() {
            engine.size();
            });
        </script>
    </body>
</html>
