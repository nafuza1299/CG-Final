<html>
    <head>
        <title>CG - Babylon</title>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
        <script src="https://code.jquery.com/pep/0.4.3/pep.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://cdn.babylonjs.com/ammo.js"></script>
        <script src="https://code.jquery.com/pep/0.4.2/pep.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/ammo.js"></script>
        <script src="https://preview.babylonjs.com/cannon.js"></script>
        <script src="https://preview.babylonjs.com/Oimo.js"></script>
        <script src="https://preview.babylonjs.com/gltf_validator.js"></script>
        <script src="https://preview.babylonjs.com/earcut.min.js"></script>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>

        <style>
          html, body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
          }
          #render {
            width: 100%;
            height: 100%;
            touch-action: none;
          }
        </style>
    <body>
        <canvas id="render" touch-action="none">
        <script>
            var canvas = document.getElementById("render");
            var engine = new BABYLON.Engine(canvas, true);
            var arr = [];


            var createScene = function() {
                var scene = new BABYLON.Scene(engine);
                    var multiplier = 17;
                    // light
                    //
                    //scene.enablePhysics(new BABYLON.Vector3(0,-9.8,0), new BABYLON.AmmoJSPlugin());
                    //button


                    // Fire light, simulates the fire intensity
                    var firelight = new BABYLON.SpotLight("spot", new BABYLON.Vector3(16, 2, 37), new BABYLON.Vector3(0, -1, 0), 4, 2, scene);
                    firelight.diffuse = new BABYLON.Color3(1.0, 0.5, 0.0);
                    firelight.intensity = 0.7;
                    firelight.range = 50;

                    var keys = [];
                    var previous = null;
                    for (var i = 0; i < 20; i++) {
                        var rand = BABYLON.Scalar.Clamp(Math.random(), 0.5, 1.0);

                        if (previous) {
                            if (Math.abs(rand - previous) < 0.1) {
                                continue;
                            }
                        }
                        previous = rand;
                        keys.push({
                            frame: i,
                            value: rand
                        });



                    var anim = new BABYLON.Animation("anim", "intensity", 1, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);
                    anim.setKeys(keys);

                    firelight.animations.push(anim);
                    scene.beginAnimation(firelight, 0, keys.length, true, 8);
                  }

                    // var lightSphere0 = BABYLON.Mesh.CreateSphere("Sphere0", 16, 0.5, scene);
                    //
                    // lightSphere0.position = new BABYLON.Vector3(-22.6, 5.5, 12.4);
                    // lightSphere0.material = new BABYLON.StandardMaterial("red", scene);
                    // lightSphere0.material.diffuseColor = new BABYLON.Color3(0, 0, 0);
                    // lightSphere0.material.specularColor = new BABYLON.Color3(0, 0, 0);
                    // lightSphere0.material.emissiveColor = new BABYLON.Color3(1, 0, 0);

                    // light
                    var light = new BABYLON.SpotLight("spot", new BABYLON.Vector3(-30, 13.35, -14), new BABYLON.Vector3(0, -1, 0), 4, 2, scene);
                    light.intensity = 0.7;
                    light.diffuse = new BABYLON.Color3(1, 1, 1);
                    light.specular = new BABYLON.Color3(0, 0, 0);
                    light.range = 70

                    //bathroom
                    // var light3 = new BABYLON.SpotLight("spt1", new BABYLON.Vector3(25, 6, 27), new BABYLON.Vector3(0, -1, 0), 6, 2, scene);
                    // light3.diffuse = new BABYLON.Color3(1, 1, 1);
                    // light3.specular = new BABYLON.Color3(0, 0, 0);

                    //diningroom light
                    var light4 = new BABYLON.SpotLight("spt2", new BABYLON.Vector3(-22, 13.35, 27), new BABYLON.Vector3(0, -1, 0), 4, 2, scene);
                    light4.intensity = 0.7;
                    light4.diffuse = new BABYLON.Color3(1, 1, 1);
                    light4.specular = new BABYLON.Color3(0, 0, 0);
                    light4.range = 70 ;

                    //bedroom
                    var light2 = new BABYLON.PointLight("light2", new BABYLON.Vector3(38, 5.7, -38), scene);
                    light2.intensity = 0.7;
                    light2.range = 60;



                    //bedroom2
                    // var light0 = new BABYLON.SpotLight("Spot0", new BABYLON.Vector3(28, 5, -15), new BABYLON.Vector3(0, -1, 0), 3, 2, scene);
                    // light0.diffuse = new BABYLON.Color3(1, 1, 1);
                    // light0.specular = new BABYLON.Color3(0, 0, 0);
                    function spawnShadow(light)
                    {
                      var shadowGenerator = new BABYLON.ShadowGenerator(1024, light);
                      shadowGenerator.useBlurExponentialShadowMap = true;
                      shadowGenerator.useKernelBlur = true;
                      shadowGenerator.blurKernel = 64;
                      shadowGenerator.forceBackFacesOnly = true;

                      shadowGenerator.setDarkness(0.4)
                      return shadowGenerator;
                    }
                    shadowGenerator = spawnShadow(light);
                    shadowGenerator2 = spawnShadow(light2);
                    shadowGenerator3 = spawnShadow(firelight);
                    shadowGenerator4 = spawnShadow(light4);


                    // camera
                    var camera = new BABYLON.FlyCamera("Camera", new BABYLON.Vector3(0, 5.569, 0), scene); // AWSD
                    //var camera = new BABYLON.ArcRotateCamera("Camera", 0, Math.PI / 2, 10, new BABYLON.Vector3.Zero(), scene);
                    camera.attachControl(canvas, true);
                    camera.maxCameraSpeed =  0.4;
                    camera.speed = .35;
                    camera.rollCorrect = 10;


                    // gravity
                    scene.gravity = new BABYLON.Vector3(0, -9.81, 0);
                    camera.applyGravity = true;
                    camera.ellipsoid = new BABYLON.Vector3(1, 7, 1);
                    scene.collisionsEnabled = true;
                    camera.checkCollisions = true;
                    scene.checkCollisions = true;
                    //pointererase
                    canvas.requestPointerLock()
                    document.exitPointerLock = document.exitPointerLock;
                    canvas.onclick = function() {
                    canvas.requestPointerLock();
                    }
                    map = {}; //object for multiple key presses
                    scene.actionManager = new BABYLON.ActionManager(scene);
                    scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger, function (evt) {
                        map[evt.sourceEvent.key] = evt.sourceEvent.type == "keydown";
                    }));
                    scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, function (evt) {
                        map[evt.sourceEvent.key] = evt.sourceEvent.type == "keydown";
                    }));

                    var floor = BABYLON.MeshBuilder.CreateGround("street", {width: 5*multiplier, height: 5*multiplier, subdivisions: 4}, scene);
                    //floor.physicsImpostor = new BABYLON.PhysicsImpostor(floor, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, friction: 0.5, restitution: 0.7 }, scene);

                    floor.position.x = 0;
                    floor.position.y = -multiplier/2;
                    floor.color = new BABYLON.Color3(1,1,1);
                    // collision house and street
                    floor.checkCollisions = true;
                    floor.receiveShadows = true;

                    //wall a
                    function makeWall(name, width, height, size, x, z, rotationy)
                    {
                        var wall = BABYLON.MeshBuilder.CreateBox(name, {width: width*multiplier, height: height*multiplier,size: size}, scene);
                        wall.position.x = x*multiplier;
                        wall.position.z = z*multiplier;
                        wall.rotation.y = rotationy;
                        wall.color = new BABYLON.Color3(0,0,0);
                        wall.checkCollisions = true;
                        wall.isPickable = false;
                        wall.receiveShadows = true;
                        shadowGenerator.getShadowMap().renderList.push(wall);
                        shadowGenerator.getShadowMap().renderList.push(wall);
                        shadowGenerator2.getShadowMap().renderList.push(wall);
                        shadowGenerator3.getShadowMap().renderList.push(wall);
                        shadowGenerator4.getShadowMap().renderList.push(wall);
                        return wall;
                    };

                    function makeborder(name, width, height, size, x, y, z, rotationy)
                    {
                        var wall = BABYLON.MeshBuilder.CreateBox(name, {width: width*multiplier, height: height*multiplier,size: size}, scene);
                        wall.position.x = x*multiplier;
                        wall.position.z = z*multiplier;
                        wall.position.y = y*multiplier;
                        wall.rotation.y = rotationy;
                        wall.color = new BABYLON.Color3(0,0,0);
                        wall.checkCollisions = true;
                        wall.isPickable = false;
                        wall.receiveShadows = true;
                        return wall;
                    };

                    //creates the walls
                    walla = makeWall("walla", 5, 1.5,1, 0,-2.5, 0); //walla
                    wallb = makeWall("wallb",5.055, 1.5, 1,-2.5,0, Math.PI/2);//wallb
                    wallc = makeWall("wallc",5.055, 1.5, 1,2.5,0, Math.PI/2);//wallc
                    walld = makeWall("walld",5, 1.5, 1,0, 2.5, 0);//walld
                    walle = makeWall("walle",3, 1.5, 1,.75,1, Math.PI/2);//walle
                    wallf = makeWall("wallf",1.25, 1.5, 1,.75,-1.875, Math.PI/2);//wallf
                    wallg = makeWall("wallg",1.5, 1.5, 1,-1.75,.75, 0);//wallg
                    wallh = makeWall("wallh",.5, 1.5, 1,2.25,.75, 0);//wallh
                    walli = makeWall("walli",1.25, 1.5, 1,.75,-1.875, Math.PI/2);//walli
                    wallk = makeWall("wallk",.75, 1.5, 1, 1.15, .75, 0);//wallk
                    bordera = makeborder("bordera",.48, .155, 1, 1.765, .6725,.75, 0);//bordera
                    borderb = makeborder("borderb",.75, .15, 1, .75, .675,-.875, Math.PI/2);//borderb
                    roof = makeWall("roof",5, 5, 1, 0, 0, 0, 0)
                    roof.rotation.x = Math.PI/2;
                    roof.position.y = .775* multiplier;
                    //firelight.excludedMeshes.push(walld)
                    //mirror
                    var mirror = BABYLON.Mesh.CreatePlane("mirror", 5.05, scene);
                    mirror.position.x = 15.615152141787308;
                    mirror.position.y = 5.2973455630738214;
                    mirror.position.z = 34.;
                    mirror.scaling.y = 1.45;
                    mirror.rotation = new BABYLON.Vector3(0, -Math.PI / 2, 0);
                    mirror.backFaceCulling = false;

                    //computation for mirroring
                    mirror.computeWorldMatrix(true);
                    var mirror_worldMatrix = mirror.getWorldMatrix();
                    var mirror_vertexData = mirror.getVerticesData("normal");
                    var mirrorNormal = new BABYLON.Vector3(mirror_vertexData[0], mirror_vertexData[1], mirror_vertexData[2]);
                    mirrorNormal = new BABYLON.Vector3.TransformNormal(mirrorNormal, mirror_worldMatrix)
                    var reflector = new BABYLON.Plane.FromPositionAndNormal(mirror.position, mirrorNormal.scale(-1));

                    function meshSetup(name, newMeshes, x, y, z, rotation, scale, bool){
                      var mesh = BABYLON.Mesh.CreateSphere(name, 10, 20, scene);
                        mesh.checkCollisions =  false;
                        mesh.isVisible = false;
                        arr.push(mesh);
                        for (i = 0; i < newMeshes.length; i++)
                        {
                          newMeshes[i].parent = mesh;
                          newMeshes[i].receiveShadows = true;
                          newMeshes[i].checkCollisions = true;
                          newMeshes[i].isVisible = bool;
                          shadowGenerator.getShadowMap().renderList.push(newMeshes[i]);
                          shadowGenerator2.getShadowMap().renderList.push(newMeshes[i]);
                          shadowGenerator3.getShadowMap().renderList.push(newMeshes[i]);
                          shadowGenerator4.getShadowMap().renderList.push(newMeshes[i]);
                          mesh.receiveShadows= true;
                          mesh.rotation.y = rotation;
                          mesh.position = new BABYLON.Vector3(x*multiplier, y, z*multiplier);
                          mesh.scaling = new BABYLON.Vector3(scale*multiplier, scale*multiplier, scale*multiplier);
                        }
                        linkMesh(mesh);
                        return mesh;
                    }

          //fire
                        var fireMaterial = new BABYLON.FireMaterial("fire", scene);
                        fireMaterial.diffuseTexture = new BABYLON.Texture("https://www.babylonjs.com/assets/fire/diffuse.png", scene);
                        fireMaterial.distortionTexture = new BABYLON.Texture("https://www.babylonjs.com/assets/fire/distortion.png", scene);
                        fireMaterial.opacityTexture = new BABYLON.Texture("https://www.babylonjs.com/assets/fire/opacity.png", scene);
                        fireMaterial.opacityTexture.level = 0.5;
                        fireMaterial.speed = 5.0;
                    BABYLON.SceneLoader.ImportMesh("", "Import/Candle/", "candle.obj", scene, function (newMeshes){
                          fire = meshSetup("fire",newMeshes, 0.98, -1.35, 2.22, Math.PI, .05, firelight, true);
                          // Create the fire plane (billboarded on Y)
                          plane = BABYLON.Mesh.CreatePlane("firePlane", 1.5, scene);
                          plane.position = new BABYLON.Vector3(16.65, 2.5, 37.3);
                          plane.scaling.x = 0.3;
                          plane.scaling.y = 1;
                          plane.billboardMode = BABYLON.Mesh.BILLBOARDMODE_Y;
                          plane.material = fireMaterial;

                    });

                    BABYLON.SceneLoader.ImportMesh("", "Import/LivingRoom/Coffee/", "coffee-table-light-wood.obj", scene, function(newMeshes) {
                          //table
                          table = meshSetup("table", newMeshes, -1.55, floor.position.y, -.75,  Math.PI/2, .75, true);
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/Bedroom/Desk/", "table2.obj", scene, function(newMeshes) {
                          //desk
                          desk = meshSetup("desk", newMeshes, 1.15, floor.position.y, 0.275, Math.PI/2, .6, true);
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/DiningRoom/Kitchen2/", "kitchen.obj", scene, function(newMeshes) {
                          //kitchen
                          kitchen = meshSetup("kitchen", newMeshes, -2.25, floor.position.y, 1.5, Math.PI/2, .05,  true);
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/LivingRoom/Sofa/", "sofa-test.obj", scene, function(newMeshes) {
                          // sofa_model
                          sofa = meshSetup("sofa", newMeshes, -.75, floor.position.y, -.75, -Math.PI/2, .1, true);
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/Bedroom/Bed/", "arc-double-bed-light-2.obj", scene, function(newMeshes) {
                          // bed
                          bed = meshSetup("bed", newMeshes, 1.65, floor.position.y, -1.75, 0, .5, true);
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/Bedroom/Lamp/", "lampa.obj", scene, function(newMeshes) {
                          //Lamp
                          lamp = meshSetup("lamp", newMeshes, 2.25, floor.position.y, -2, 0, .5, true);
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/Bathroom/Toilet/", "toilet-water-closet.obj", scene, function(newMeshes) {
                          //toilet
                          toilet = meshSetup("toilet", newMeshes, 1, floor.position.y, 1.25, Math.PI/2, .0125,  true);
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/Bathroom/Sink/", "bathroom-2.obj", scene, function(newMeshes) {
                          //sink
                          sink = meshSetup("sink", newMeshes, 1, floor.position.y, 2, Math.PI/2, 50,  true);
                    });
                     BABYLON.SceneLoader.ImportMesh("", "Import/DiningRoom/DiningTable/", "table-and-chairs.obj", scene, function(newMeshes) {
                          // diningtable
                          diningtable = meshSetup("diningtable", newMeshes, -.25,floor.position.y, 1.5, 0, .5,  true);
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/Bathroom/Bath/", "bath_obj.obj", scene, function(newMeshes) {
                          // tub
                          bath = meshSetup("bath", newMeshes, 2.2, floor.position.y, 1.85, Math.PI/2, .025,  true);
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/Ghost/", "annies-ghost.obj", scene, function(newMeshes) {
                          //table
                          ghost = meshSetup("ghost", newMeshes, -1.75,floor.position.y, .55, Math.PI, .15,  true);
                    });
                    BABYLON.SceneLoader.ImportMesh("", "Import/LivingRoom/Furniture/", "lcd-table.obj", scene, function(newMeshes) {
                         //table
                         furniture = meshSetup("furniture", newMeshes, -2.4, floor.position.y, -.75, 0, .5,  true);
                   });
                   BABYLON.SceneLoader.ImportMesh("", "Import/Door/", "door-dorian-stradivari-01-konjak.obj", scene, function(newMeshes) {
                        //table
                        door = meshSetup("door", newMeshes, 1.5, floor.position.y, .8, Math.PI/2, .5, true);
                        openDoor(door);


                  });
                    var mirrormaterial = new BABYLON.StandardMaterial("texture4", scene);
                    mirrormaterial.diffuseColor = new BABYLON.Color3(0.1, 0.1, 0.1);
                    mirrormaterial.reflectionTexture = new BABYLON.MirrorTexture("mirror", 512, scene, true); //Create a mirror texture
                    mirrormaterial.reflectionTexture.mirrorPlane = reflector;
                    mirrormaterial.reflectionTexture.renderList = [walla, wallb, wallc, walld, walle, wallf, wallg, wallh, walli,bordera,borderb, floor, roof];
                    mirrormaterial.reflectionTexture.level = 1;//Select the level (0.0 > 1.0) of the reflection*/
                    mirror.material = mirrormaterial;

                      var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");
                      function text(desc, color, size, font, weight, left, top){
                        var words = new BABYLON.GUI.TextBlock();
                            words.text = desc;
                            words.color = color;
                            words.fontSize = size;
                            words.fontFamily = font;
                            words.fontWeight = weight;
                            words.left = left;
                            words.top	 = top;
                        advancedTexture.addControl(words);
                        return words;

                      };
                      function updateText(text, desc)
                      {
                        text.text = desc;
                      }
                      var rect1 = new BABYLON.GUI.Rectangle();
                          rect1.width = 0.2;
                          rect1.height = "100px";
                          rect1.cornerRadius = 10;
                          rect1.color = "black";
                          rect1.thickness = 0;
                          rect1.background = "black";
                          rect1.alpha = .5;
                          rect1.left = "-700px";
                          rect1.top	 = "-290px";
                          advancedTexture.addControl(rect1);

                      var crosshair = new BABYLON.GUI.Ellipse();
                          crosshair.width = "20px";
                          crosshair.height = "20px";
                          crosshair.alpha = .5;
                          crosshair.color = "white";
                          crosshair.thickness = 1;
                          crosshair.background = "transparent";
                          advancedTexture.addControl(crosshair);

                    var objectives = "- Make Breakfast"
                    objectiive = text("Objectives:", "white", 24, "Times", "bold", "-700px","-300px");
                    task = text(objectives, "white", 20, "Times", "", "-680px","-270px");



                    function openDoor(mesh){
                      mesh.setPivotMatrix(BABYLON.Matrix.Translation(0 ,0, .5));
                      scene.registerAfterRender(function() {
                        var flag = 0;
                        if ((map["e"]) || (map["E"]))  {
                          if( BABYLON.Vector3.Distance(camera.position,mesh.position)<20 && pickResult.pickedMesh.parent == mesh){
                            //console.log(mesh.name);
                              for (i = 0; i < 15; i++){
                                mesh.rotate(BABYLON.Axis.Y, -Math.PI / 64, BABYLON.Space.LOCAL);
                                if (i > 15){
                                  mesh.rotate(BABYLON.Axis.Y, Math.PI / 64, BABYLON.Space.LOCAL);
                                }
                                }
                              }
                          }

                      });
                    }
                    function linkMesh(mesh) {
                          var rect1 = new BABYLON.GUI.Rectangle();
                            rect1.width = 0.1;
                            rect1.height = "40px";
                            rect1.color = "white";
                            rect1.thickness = 4;
                            rect1.background = "transparent";
                            advancedTexture.addControl(rect1);
                            rect1.linkOffsetY = -600;
                          var label = new BABYLON.GUI.TextBlock();
                            label.text = "E";
                            rect1.addControl(label);
                          var target = new BABYLON.GUI.Ellipse();
                            target.width = "40px";
                            target.height = "40px";
                            target.color = "white";
                            target.thickness = 4;
                            target.background = "transparent";
                            target.linkOffsetY = -400;
                          advancedTexture.addControl(target);
                          var line = new BABYLON.GUI.Line();
                            line.lineWidth = 4
                            line.color = "whites";
                            line.y2 = 20;
                            line.linkOffsetY = -420;
                            advancedTexture.addControl(line);
                            line.connectedControl = rect1;
                            rect1.isPickable = false;
                            target.isPickable = false
                            line.isPickable = false;
                            rect1.linkWithMesh(mesh);
                            target.linkWithMesh(mesh);
                            line.linkWithMesh(mesh);

                          scene.registerBeforeRender(function() {
                            if (BABYLON.Vector3.Distance(camera.position,mesh.position)<20){
                              rect1.isVisible = true;
                              target.isVisible = true;
                              line.isVisible = true;
                            };

                            if ((map["e"]) || (map["E"]) && BABYLON.Vector3.Distance(camera.position,mesh.position)<20) {
                                //console.log(mesh.name);
                                rect1.isVisible = false;
                                target.isVisible = false;
                                line.isVisible = false;
                                label.text = "E";
                            };

                            if (BABYLON.Vector3.Distance(camera.position,mesh.position)>30){
                              rect1.isVisible = false;
                              target.isVisible = false;
                              line.isVisible = false;
                            };
                          });
                  	};

                    var width = scene.getEngine().getRenderWidth();
                    var height = scene.getEngine().getRenderHeight();


                    var i = 3;//timecounter

                    function textmesh(mesh, text2){
                      desc = text(text2, "white", 20, "Times", "", "0px","240px");
                      desc.alpha = 0;



                          if(pickResult.pickedMesh.parent == mesh && BABYLON.Vector3.Distance(camera.position, mesh.position)<20){
                            console.log(i);
                            var handle = window.setInterval(() => {
                              i--;


                              if (i <= 0) {
                                window.clearInterval(handle);
                                desc.alpha=0;


                              }
                            if(i > 0){
                              desc.alpha=1;
                            }
                          }, 1000);

                          }



                        return desc;
                    }

                    scene.registerAfterRender(function () {
                        //console.log(camera.position);

                    		pickResult = scene.pick(width/2, height/2,
                                        function(mesh) { return mesh.isVisible && mesh.isReady()},
                                        false,
                                        camera);

                        if ((map["e"]) || (map["E"])){
                            textmesh(table, "Try");

                        }
                        if ((map["Shift"])) {
                            camera.maxCameraSpeed =  .75;
                            camera.speed = .65;

                            }
                        else{
                          camera.maxCameraSpeed =  0.3;
                          camera.speed = .25;
                        };

                    });

            return scene;
            }
            var scene = createScene();
            engine.runRenderLoop(function() {
            scene.render();
            });
            window.addEventListener("size", function() {
            engine.size();
            });
        </script>
    </body>
</html>
